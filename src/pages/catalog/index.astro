---
import { supabase } from "../../utils/database";
import Layout from "../../components/Layout.astro";
export const prerender = false;

let parts = [];
let partsError = null;

// Fetch data dari database
if (supabase) {
  const { data, error } = await supabase
    .from("aircraft_parts")
    .select("*")
    .order("part_number", { ascending: true });
  parts = data;
  partsError = error;
}
---

<Layout>
  <main class="flex-grow">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12 mt-12">
        <h1 class="text-3xl font-bold mb-2 text-gray-100">Aircraft Parts Catalog</h1>
        <p class="text-lg text-gray-200 max-w-3xl mx-auto">
          Browse our complete inventory of certified and quality aircraft parts
        </p>
      </div>

      {
        partsError && (
          <div class="bg-red-50 border border-red-500 text-red-600 px-4 py-3 rounded-lg mb-8">
            <strong>Database Error:</strong> {partsError.message}
          </div>
        )
      }

      {
        parts && parts.length > 0 ? (
          <table class="w-full divide-y divide-gray-200">
            <thead class="bg-gray-700">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Part Number
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Description
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Aircraft
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Qty
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Condition
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Location
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-100 uppercase tracking-wider">
                  Action
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              {parts.map((part) => (
                <tr key={part.id} class="bg-gray-800">
                  <td class="px-6 py-4 text-sm font-medium text-gray-100">
                    {part.part_number}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">
                    {part.description}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">
                    <span class="bg-blue-500 text-blue-100 px-2 py-1 rounded-full text-xs font-medium">
                      {part.aircraft_effectivity}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300 text-center">
                    <span class="bg-green-500 text-green-100 px-2 py-1 rounded-full text-xs font-medium">
                      {part.quantity} {part.uom}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">
                    {part.condition}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-300">
                    <span class="bg-yellow-500 text-yellow-100 px-2 py-1 rounded-full text-xs font-medium">
                      {part.location}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm font-medium text-gray-300 text-center">
                    <button class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium hover:bg-blue-700">
                      Request Quote
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        ) : (
          <div class="p-3 text-center text-gray-200">
            <p class="mb-2">No parts found in inventory</p>
            <p>Please check back later or contact our sales team.</p>
          </div>
        )
      }

      <div
        class="bg-gray-900 border border-gray-600 rounded-lg p-4 mt-8 text-center"
      >
        <h3 class="mb-2 text-blue-600 text-lg">
          Can't find what you're looking for?
        </h3>
        <p class="mb-2 text-gray-300">
          Contact our sales team for special requests or bulk orders
        </p>
        <button
          class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium hover:bg-blue-700"
        >
          Contact Sales
        </button>
      </div>
    </div>
  </main>
</Layout>
